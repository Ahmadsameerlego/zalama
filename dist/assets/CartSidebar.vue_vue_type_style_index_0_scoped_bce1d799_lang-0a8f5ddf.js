import{k as _,p as C,b as n,c,e,t as o,F as y,s as b,D as x,f as g,_ as N,u as O,r as w,j as k,d as S,w as P,q as I,i as F,g as q,y as D,T as L,m as V,n as $}from"./index-4c615b4d.js";import{T as z}from"./Toast-7c860256.js";const J=["dir"],A=["src","alt"],E={class:"p-3 sm:p-4 flex-1 flex flex-col justify-between text-right"},H={class:"font-semibold text-lg mb-1"},R={class:"text-gray-500 text-sm line-clamp-2"},U={class:"mt-3 font-bold text-primary text-lg flex flex-row-reverse gap-2 items-center"},G={class:"text-red-600"},K={class:"text-gray-400 line-through text-base"},Q={key:1},W={key:0,class:"mt-2 flex flex-row-reverse items-center gap-2"},X={class:"mx-1"},fe={__name:"ProductCard",props:{product:{type:Object,required:!0},rtl:{type:Boolean,default:!1},showDiscount:{type:Boolean,default:!1}},setup(s){const m=_("cart"),h=_("increaseCartItem"),p=_("decreaseCartItem"),a=C(()=>(!m||!m.value,null));return(l,d)=>(n(),c("div",{class:"bg-white rounded-xl shadow hover:shadow-lg transition cursor-pointer overflow-hidden flex flex-col min-w-[280px] sm:min-w-[300px] md:min-w-[320px]",onClick:d[2]||(d[2]=u=>l.$emit("click")),dir:s.rtl?"rtl":"ltr"},[e("img",{src:s.product.image,alt:s.product.title,class:"h-32 sm:h-36 md:h-40 w-full object-contain"},null,8,A),e("div",E,[e("div",null,[e("h3",H,o(s.product.title),1),e("p",R,o(s.product.desc),1)]),e("div",U,[s.product.price_with_value!=0&&s.product.old_price_with_value&&s.product.price_with_value&&s.product.price_with_value<s.product.old_price_with_value?(n(),c(y,{key:0},[e("span",G,o(s.product.price_with_value)+" "+o(l.$t("product.currency")),1),e("span",K,o(s.product.old_price_with_value)+" "+o(l.$t("product.currency")),1)],64)):(n(),c("span",Q,o(s.product.price_with_value)+" "+o(l.$t("product.currency")),1))]),a.value?(n(),c("div",W,[e("button",{onClick:d[0]||(d[0]=b(u=>x(h)(a.value._key),["stop"])),class:"bg-gray-200 rounded px-2"},"+"),e("span",X,o(a.value.quantity),1),e("button",{onClick:d[1]||(d[1]=b(u=>x(p)(a.value._key),["stop"])),class:"bg-gray-200 rounded px-2"},"-")])):g("",!0)])],8,J))}};const Y={key:0,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/40"},Z={class:"bg-white rounded-xl shadow-lg w-full max-w-md mx-4 p-6 relative animate-fade-in",dir:"rtl"},ee=["src","alt"],te={class:"text-2xl font-bold mb-1"},se={class:"text-gray-500 mb-2"},oe={class:"mb-4"},re={class:"font-semibold text-[#111]"},ae={class:"ml-2 font-bold text-lg"},le={key:0,class:"mb-4"},ie={class:"font-semibold mb-1 text-[#111]"},ne={class:"flex flex-col gap-2"},ce=["value"],de={class:"font-semibold text-md"},ue={class:"flex items-center justify-between mt-6"},pe={class:"font-bold text-lg text-[#111]"},ve={__name:"ProductModal",props:{product:{type:Object,required:!0},open:{type:Boolean,default:!1}},emits:["close","add-to-cart"],setup(s,{emit:m}){const h=O(),p=w({visible:!1,message:"",type:"success"}),a=(t,r="success")=>{p.value={visible:!0,message:t,type:r},setTimeout(()=>p.value.visible=!1,3e3)},l=s,d=m,u=w([]),j=C(()=>{let t=Number(l.product.price_with_value);for(const r of u.value)t+=Number(r.price_with_value);return t}),f=w(l.product.is_favourite||!1);async function T(){const t=JSON.parse(localStorage.getItem("user")||"{}");if(!t||!t.id){a("يجب تسجيل الدخول أولاً","error"),setTimeout(()=>h.push("/login"),1500);return}try{const r={user_id:t.id,service_id:l.product.id},{data:i}=await $.post("/api/add-to-favourite",r);i.key===1?(f.value=!f.value,a(i.msg,"success")):a(i.msg||"حدث خطأ أثناء تعديل المفضلة","error")}catch(r){console.error("Favourite error:",r),a("فشل الاتصال بالخادم","error")}}k(()=>l.open,t=>{t&&(u.value=[],f.value=l.product.is_favourite||!1)});async function B(){const t=JSON.parse(localStorage.getItem("user")||"{}");if(!t||!t.id){a("يجب تسجيل الدخول أولاً","error"),setTimeout(()=>h.push("/login"),1500);return}try{const r=u.value.map(M=>M.id),i={user_id:t.id,service_id:l.product.id,count:1,option_ids:JSON.stringify(r)},{data:v}=await $.post("/api/add-to-cart",i);v.key===1?(a(v.msg,"success"),setTimeout(()=>{d("add-to-cart",v.data),d("close")},1e3)):a(v.msg||"حدث خطأ أثناء إضافة المنتج","error")}catch(r){console.error("Add to cart error:",r),a("فشل الاتصال بالخادم","error")}}return k(()=>l.open,t=>{t||(u.value=[])}),(t,r)=>(n(),c(y,null,[S(L,{name:"fade-slide"},{default:P(()=>[s.open?(n(),c("div",Y,[e("div",Z,[e("button",{class:"absolute top-3 left-3 text-gray-400 hover:text-gray-700 bg-white rounded-full p-1 shadow-md hover:shadow-lg transition-all",onClick:r[0]||(r[0]=i=>t.$emit("close"))},r[2]||(r[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("button",{class:"absolute top-3 right-3 text-gray-400 hover:text-red-500 bg-white rounded-full p-1 shadow-md hover:shadow-lg transition-all",onClick:T},[(n(),c("svg",{xmlns:"http://www.w3.org/2000/svg",class:I(["h-6 w-6",f.value?"fill-red-500 stroke-red-500":"stroke-gray-500"]),viewBox:"0 0 24 24",stroke:"currentColor",fill:"none"},r[3]||(r[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:`M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 
         116.364 6.364L12 21.364l-7.682-7.682a4.5 4.5 
         0 010-6.364z`},null,-1)]),2))]),e("img",{src:s.product.image,alt:s.product.title,class:"w-full h-48 object-contain rounded mb-4"},null,8,ee),e("h2",te,o(s.product.title),1),e("p",se,o(s.product.desc),1),e("div",oe,[e("span",re,o(t.$t("product.basePrice"))+":",1),e("span",ae,o(s.product.price_with_value)+" "+o(t.$t("product.currency")),1)]),s.product.options&&s.product.options.length>0?(n(),c("div",le,[e("div",ie,o(t.$t("product.addOns"))+": ",1),e("div",ne,[(n(!0),c(y,null,F(s.product.options,i=>(n(),c("label",{key:i.id,class:"flex items-center gap-2"},[q(e("input",{type:"checkbox","onUpdate:modelValue":r[1]||(r[1]=v=>u.value=v),value:i},null,8,ce),[[D,u.value]]),e("span",de,o(i.title)+" (+"+o(i.price_with_value)+" "+o(t.$t("product.currency"))+")",1)]))),128))])])):g("",!0),e("div",ue,[e("div",pe,o(t.$t("product.total"))+": "+o(j.value)+" "+o(t.$t("product.currency")),1),e("button",{class:"bg-primary text-white px-5 py-2 rounded-full font-semibold hover:bg-primary-dark transition",onClick:B},o(t.$t("product.addToCart")),1)])])])):g("",!0)]),_:1}),p.value.visible?(n(),V(z,{key:0,message:p.value.message,type:p.value.type,visible:p.value.visible},null,8,["message","type","visible"])):g("",!0)],64))}},ge=N(ve,[["__scopeId","data-v-473e2755"]]);export{ge as P,fe as _};
